## Secret Management

```{image} ../img/vault.svg
:width: 200px
```

### Ansible Vault
```{revealjs-fragments}
* create/view/edit
* decrypt/encrypt/encrypt_string
* rekey
```

### Ansible Vault
```
$ANSIBLE_VAULT;1.2;AES256;dev
37636561366636643464376336303466613062633537323632306566653533383833366462366662
6565353063303065303831323539656138653863353230620a653638643639333133306331336365
62373737623337616130386137373461306535383538373162316263386165376131623631323434
3866363862363335620a376466656164383032633338306162326639643635663936623939666238
3161
```

### Age
```{revealjs-fragments}
* passphrase
* keys
```

### Age
```console
$ age -p secrets.txt > secrets.txt.age
Enter passphrase (leave empty to autogenerate a secure one):
Using the autogenerated passphrase "release-response-step-brand-wrap-ankle-pair-unusual-sword-train".
$ age -d secrets.txt.age > secrets.txt
Enter passphrase:
```

### Age
```console
$ cat recipients.txt
# Alice
age1ql3z7hjy54pw3hyww5ayyfg7zqgvc7w3j2elw8zmrj2kg5sfn9aqmcac8p
# Bob
age1lggyhqrw2nlhcxprm67z43rta597azn8gknawjehu9d9dl0jq3yqqvfafg
$ age -R recipients.txt example.jpg > example.jpg.age
```

### Sops
```{revealjs-fragments}
* PGP/AGE
* KMS Azure/AWS/GCP
* Hashicorp Vault
```

### Sops
`command line`
```console
$ sops --encrypt --age age1yt3tfqlfrwdwx... \
    test.yaml > test.enc.yaml
```

`.sops.yaml`
```yaml
creation_rules:
- pgp: >-
    85D77543B3D624B63CEA9E6DBC17301B491B3F21,
    FBC7B9E2A4F9289AC0C1D4843D16CEE4A27381B4
```

### Sops Types
```{revealjs-fragments}
* YAML
* JSON
* ENV
* INI
```

### Sops Types
```console
$ sops -e myfile.json > myfile.json.enc
$ sops -d --input-type json myfile.json.enc
```

### Sops Exec
```console
$ sops exec-env out.json 'echo secret: $database_password; ./database-import'
secret: jf48t9wfw094gf4nhdf023r
$ sops exec-file --no-fifo out.json 'TMPFILE={} sh'
sh-3.2$ echo $TMPFILE
/tmp/.sops506055069/tmp-file291138648
```

### Hashicorp Vault

```{image} ../img/vault1.jpg
:width: 650px
```

### Hashicorp Vault

```{image} ../img/vault2.jpg
:width: 500px
```

### KV Engine

```{image} ../img/vault-kv.jpg
:width: 700px
```

### LDAP Engine

```{image} ../img/vault-ldap.jpg
:width: 700px
```

### PKI Engine

```{image} ../img/vault-pki.jpg
:width: 700px
```

### Transit Engine

```{image} ../img/vault-transit.jpg
:width: 700px
```

### SSH OTP

```{image} ../img/vault-ssh-otp.jpg
:width: 700px
```

### Vault Agent

```{image} ../img/vault-agent.jpg
:width: 700px
```
